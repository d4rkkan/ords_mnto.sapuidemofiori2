sap.ui.define(["cbc/co/simulador_costos/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","sap/m/MessageToast","sap/ui/core/EventBus","sap/m/MessageBox"],function(e,t,o,a,r,i){"use strict";var s=e.extend("cbc.co.simulador_costos.controller.Utilities.Formuladora",{onInit:function(){var e=this.getOwnerComponent().getRouter().getRoute("rtChFromuladora");e.attachPatternMatched(this.onMyRoutePatternMatched,this)},onAfterRendering:function(){},onDataReceived:function(e,t,o){},onMyRoutePatternMatched:function(e){var o=this.getView().byId("builder");o.setShowInputToolbar(true);o.destroyFunctions();o.removeAllFunctions();o.allowFunction("ABS",false);o.allowFunction("Round",false);o.allowFunction("RoundUp",false);o.allowFunction("RoundDown",false);o.allowFunction("SQRT",false);this.oIdCommoditie=e.getParameter("arguments").oIdCommoditie;this.oSociedad=e.getParameter("arguments").oSociedad;this.oCentro=e.getParameter("arguments").oCentro;this.oYear=e.getParameter("arguments").oYear;this.oMes=e.getParameter("arguments").oMes;this.oVersion=e.getParameter("arguments").oVersion;this.oIdFormula=e.getParameter("arguments").oIdFormula;this.oTxtFormula=e.getParameter("arguments").oTxt;this.oTxtFormula=decodeURIComponent(this.oTxtFormula);if(this.oTxtFormula==="0"){this.oTxtFormula=" "}var a="Id Commoditie:"+this.oIdCommoditie+" - Sociedad:"+this.oSociedad+" - Centro:"+this.oCentro+" - AÃ±o:"+this.oYear+" - Mes:"+this.oMes+" - Version:"+this.oVersion;var r=new t;var i={expression:this.oTxtFormula,title:a,showToolbar:false,layoutType:"VisualOnly",showInputToolbar:false,allowComparison:false,allowComparisonOperators:false,allowLogical:false,readOnly:false,variables:[{key:"Precio",label:"Precio"},{key:"OtrosCostos",label:"Otros Costos"},{key:"PesoMaterial",label:"Peso Material"}]};r.setData(i);this.getView().setModel(r);this.getView().getModel().refresh()},onToPage1:function(e){var t=o.getInstance().getPreviousHash();if(t!==undefined){window.history.go(-1)}else{this.getOwnerComponent().getRouter().navTo("rtChCommodities",null,true)}},saveFormula:function(e){var t=this.getView().getModel("ModelSimulador"),o=this.getView().byId("builder"),a=o.getProperty("expression"),r=this.getView().getModel("ModelSimulador").sServiceUrl,s=new sap.ui.model.odata.ODataModel(r,true),n={};n={IdCommoditie:this.oIdCommoditie,Sociedad:this.oSociedad,Centro:this.oCentro,Fotrcost:this.oIdFormula,Txtlg:a,Year:this.oYear,Mes:this.oMes,Version:this.oVersion};var l=this.fnCreateEntity(s,"/formuladoraSet",n);if(l.tipo==="S"){this.oIdFormula=l.datos.Fotrcost;var d="Id Commoditie:"+this.oIdCommoditie+" - Id Formula:"+this.oIdFormula;o.getModel().setProperty("title",d);i.show("Datos guardados correctamente",{icon:i.Icon.SUCCESS,title:"Exito",actions:[i.Action.OK],onClose:function(e){if(e===sap.m.MessageBox.Action.OK){return}}})}else if(l.tipo==="E"){i.show(l.msjs,{icon:i.Icon.ERROR,title:"Error"})}},layoutTypeChanged:function(e){var t=e.getSource().getProperty("selectedKey");this._oBuilder.setShowInputToolbar(t==="TextualOnly")},handleChange:function(e){var t=e.getSource().getSelectedItem(),o=t.getCustomData(),a=o[0].getKey();this.getView().byId("builder").updateOrCreateItem(a)},setSelection:function(e){var t=this.getView().byId("Tree"),o=e.getParameter("key");if(!o){var a=t.getSelectedItem();if(a){t.setSelectedItem(a,false)}}else{var r=t.getItems();for(var i=0;i<r.length;i++){var s=r[i],n=r[i].getCustomData()[0].getValue();if(o===n){t.setSelectedItem(s,true);return}}}}});return s});