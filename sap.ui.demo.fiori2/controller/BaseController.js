sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/routing/History","sap/m/Dialog","sap/m/Button","sap/m/MessageToast","sap/m/Text","sap/m/MessageBox","sap/ui/core/util/Export","sap/ui/core/util/ExportTypeCSV","sap/ui/core/message/Message","sap/ui/core/MessageType","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,r,s,o,a,n,i,u,l,g,p,c){"use strict";var f;return e.extend("sap.ui.demo.fiori2.controller.BaseController",{getRouter:function(){return this.getOwnerComponent().getRouter()},getModel:function(e){return this.getView().getModel(e)},setModel:function(e,t){return this.getView().setModel(e,t)},getResourceBundle:function(){return this.getOwnerComponent().getModel("i18n").getResourceBundle()},onNavBack:function(){var e=t.getInstance().getPreviousHash();if(e!==undefined){history.go(-1)}else{this.getRouter().navTo("master",{},true)}},f_crear_fargment:function(e){if(!this._valueHelpDialog){this._valueHelpDialog=sap.ui.xmlfragment(e,this);this.getView().addDependent(this._valueHelpDialog)}this._valueHelpDialog.open()},fnReadEntity:function(e,t,r){var s=null;var o={};var a=function(e,t){o.tipo="S";o.datos=e};var n=function(e){s=JSON.parse(e.response.body);s=s.error.message.value;o.tipo="E";o.msjs=s};e.read(t,null,r,false,a,n);return o},fnGetEntity:function(e,t,r){var s=null;var o={};var a=function(e,t){o.tipo="S";o.datos=t};var n=function(e){s=JSON.parse(e.response.body);s=s.error.message.value;o.tipo="E";o.msjs=s};e.read(t,null,r,false,a,n);return o},fnOpenDialog:function(e){this.oFragment=new Object;this.oFragment.view=null;this.fnLoadDialog(e,this.oFragment);this.oFragment.view.open()},fnCloseFragment:function(){this.fnCloseDialog(this.oFragment);delete this.oFragment},fnLoadDialog:function(e,t){if(t.view){return}t.view=sap.ui.xmlfragment(e,this);this.getView().addDependent(t.view)},fnCloseDialog:function(e){e.view.destroy()},fnCreateEntity:function(e,t,r){var s=null;var o={};var a=function(e,t){o.tipo="S";o.datos=e};var n=function(e){s=JSON.parse(e.response.body);s=s.error.message.value;o.tipo="E";o.msjs=s};e.create(t,r,null,a,n,false);return o},f_onApproveDialog:function(e,t,o,n){var i=new r({title:"Confirmaci√≥n",type:"Message",content:new a({text:e}),beginButton:new s({text:"Si",press:[null,t,n]}),endButton:new s({text:"No",press:[null,o,n]}),afterClose:function(){i.destroy()}});return i},fnUpdateEntity:function(e,t,r){var s=null;var o={};var a=function(e,t){o.tipo="S";o.response=t;o.datos=e};var n=function(e){s=JSON.parse(e.response.body);s=s.error.message.value;o.tipo="E";o.msjs=s};e.update(t,r,null,a,n,false);return o},fnRemoveEntity:function(e,t){var r=null;var s={};var o=function(e,t){s.tipo="S";s.response=t};var a=function(e){r=JSON.parse(e.response.body);r=r.error.message.value;s.tipo="E";s.msjs=r};e.remove(t,null,o,a,false);return s},formatDate:function(e){jQuery.sap.require("sap.ui.core.format.DateFormat");var t=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"dd-MM-YYYY"});return t.format(new Date(e))},fnCreateEntityAsy:function(e,t,r,s){var o=null;var a={};var n=jQuery.Deferred();var i=function(e,t){a.tipo="S";a.datos=e;n.resolve(a)};var u=function(e){o=JSON.parse(e.response.body);o=o.error.message.value;a.tipo="E";a.msjs=o;n.reject(o)};e.create(t,r,{context:null,success:i,error:u,async:s});return n},fnReadEntityAsyn:function(e,t,r,s){var o=null;var a={};var n=jQuery.Deferred();var i=function(e,t){a.tipo="S";a.datos=e;n.resolve(a)};var u=function(e){o=JSON.parse(e.response.body);o=o.error.message.value;a.tipo="E";a.msjs=o;n.reject(o)};e.read(t,null,r,s,i,u);return n},showGeneralError:function(e){e=jQuery.extend({message:"",additionalData:"",oDataError:"",title:"",onClose:function(){}},e);var t="",r="";if(e.message){t=e.message}else{t=this.getResourceBundle().getText("technicalError")}if(e.additionalData){r=e.additionalData}if(e.oDataError){try{var s=jQuery.parseJSON(e.oDataError.responseText);r=s.error.message.value}catch(t){r=e.oDataError}}jQuery.sap.log.error(t);jQuery.sap.log.error(r);var o=e.title?e.title:this.getResourceBundle().getText("errorTitleMessageBox");n.show(t,{icon:sap.m.MessageBox.Icon.ERROR,title:o,onClose:e.onClose,details:r,actions:sap.m.MessageBox.Action.CLOSE})},cvsDataExport:function(e,t,r="/"){var s=new i({exportType:new u({separatorChar:";"}),models:e,rows:{path:r},columns:t});s.saveFile().catch(function(e){this.showGeneralError({oDataError:e})}).then(function(){s.destroy()})},isInitialNum:function(e,t="."){if(e!==undefined){e=e.replace(t,"").replace(new RegExp("0","g"),"").trim()}return e},csv_to_Json:function(e,t){var r=e.split("\n");var s=[];var o=r[0].split(t);for(var a=1;a<r.length-1;a++){var n={};var i=r[a].split(t);for(var u=0;u<o.length;u++){n[u]=i[u]}s.push(n)}var l=JSON.stringify(s);var g=JSON.parse(l.replace(/\\r/g,""));return g},initMessageManager(){this.oMessageManager=sap.ui.getCore().getMessageManager();this.setModel(this.oMessageManager.getMessageModel(),"message");this.oMessageManager.registerObject(this.getView(),true)},addMessage(e){sap.ui.getCore().getMessageManager().removeAllMessages();e.target="/Dummy";e.processor=this.getView().getModel();sap.ui.getCore().getMessageManager().addMessages(e)},onMessagePopoverPress:function(e){this._getMessagePopover().openBy(e.getSource())},_getMessagePopover:function(){if(!this._oMessagePopover){this._oMessagePopover=sap.ui.xmlfragment(this.getView().getId(),"sap.ui.demo.fiori2.view.Utilities.fragments.MessagePopover",this);this.getView().addDependent(this._oMessagePopover)}return this._oMessagePopover},startProcessConsult:function(e,t){if(e!==""){setTimeout(this.getProcessStatus,3e3,e,t)}},getProcessStatus:function(e,t){var r=this.getView().getModel("ModelSimulador");var s=[];if(e!==""){s.push(new p("IdProceso",c.EQ,e));s.push(new p("Modulo",c.EQ,t));this.getModel("modelView").setProperty("/busy",true);r.read("/procesoImportSet",{filters:s,success:function(e,t){this.addMessage(new l({message:"Import finalizado con exito",type:g.Success}));this.getModel("modelView").setProperty("/processId","");this.getModel("modelView").setProperty("/busy",false)}.bind(this),error:function(e){this.addMessage(new l({message:"Import finalizado con errores",type:g.Success}));this.getModel("modelView").setProperty("/processId","");this.getModel("modelView").setProperty("/busy",false)}.bind(this)})}},uuidv4:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,r=e==="x"?t:t&3|8;return r.toString(16)})}})});